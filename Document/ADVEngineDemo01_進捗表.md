# ADVEngineDemo 進捗表

**プロジェクト名**: ADVEngineDemo  
**エンジン**: Godot Engine 4.5.1  
**言語**: GDScript  
**更新日**: 2026年1月20日

---

## プロジェクト概要

### 目標
Godot Engine 4.xで作成する、高機能かつ拡張性の高いアドベンチャーゲームエンジン。

### 主要機能（目標）

#### ✅ 実装済み
- ✅ テキストベースシナリオ読み込み（`.txt`形式）
- ✅ メッセージウインドウ表示（複数ウインドウ対応）
- ✅ 背景画像切り替え
- ✅ キャラクター立ち絵表示・非表示
- ✅ BGM/SE再生システム
- ✅ フェード/クロスフェード
- ✅ タイトル画面
- ✅ コマンドパターンによる拡張システム
- ✅ キャラクターエディター（プラグイン）
- ✅ 待機コマンド（@wait）
- ✅ ウインドウ切り替えコマンド（@window）
- ✅ UIの多言語対応（日本語/英語）
- ✅ シナリオのジャンプ、タグのジャンプ機能 @jump 

#### 🚧 未実装（計画中）

#### Phase 1: コアロジック（データ構造の確定）

クリッカブルマップのために**「変数」**の実装がより重要になります。

1. **🚧 変数・フラグ管理**
   - （これが無いと、「鍵を拾った」「証拠を見つけた」状態を管理できません）
2. **🚧 条件分岐**
3. **🚧 選択肢システム**
   - （クリッカブルマップは「画像を使った選択肢」と捉えることもできます）

#### Phase 2: 探索・ゲームプレイ基盤

セーブを作る前に、**「探索パート」**の仕組みを作ります。なぜなら、探索状況（どの証拠を見つけたか）もセーブデータに含める必要があるからです。

1. **🆕 クリッカブルマップ（探索パート）の実装**
   - （画面上の指定座標をクリックすると、イベントが走り、アイテム入手やテキスト再生を行う機能）
2. **🆕 証拠品/インベントリ管理画面**
   - （探索で見つけたものを格納・閲覧する画面）
3. **🚧 リッチテキスト演出**
4. **シナリオ翻訳機能**
   1. 言語ごとにフォルダーを分けるようにすること。
   2. ファイルテキストのラベル名などをルール化すること。
5. **🆕 バックログ（メッセージ履歴）**
   - 「言語切り替え時にバックログの中身も翻訳」
   - のちのちセーブに対応する必要あり。

#### Phase 3: システム基盤（保存と設定）

ゲームの状態定義が出揃ったので、それをファイルに書き出す機能を実装します。

1. **🚧 設定画面**（音量、テキスト速度、キーコンフィグ）
2. **🚧 キーボード/コントローラー対応**
3. **キーバインド・操作ガイド表示（UI）**
   - 現在の入力設定（InputMap）を読み取って、アイコンやテキストを画面隅に出す共通パーツを作成します。
4. **🚧 オートモード / スキップモード**
5. **🚧 セーブ/ロードシステム**
   - （通常のシナリオ位置だけでなく、「探索済みの場所」「所持品」も保存対象になります）
   - サムネイル付きセーブデータ作成

#### Phase 4: 探偵・QTE特化（ゴール）

1. **🚧 TIPS/用語集システム**
2. 🚧 コレクション機能（CG解放など）
3. **🆕 フローチャートUIシステム**
4. **🆕 ミニゲーム(QET)用フック/割り込み処理**

#### Phase 5: 演出（仕上げ）

1. **🚧 背景やスチルの切り替え演出**
2. **🚧 パララクス表示（立ち絵・背景・アイテム）**
3. 🚧ポストエフェクト（Unityライク）
4.  🚧ピクチャーインピクチャー演出

## 将来の拡張予定

### 優先度：高

#### セーブ/ロードシステム
- セーブデータ管理
- セーブスロット選択
- オートセーブ
- クイックセーブ/ロード

#### 選択肢システム
```
@choice
選択肢A|選択肢B|選択肢C
@choice_result {result_variable}
```

#### 変数・フラグ管理
```
@set flag_name=value
@if flag_name == value
    # 条件分岐
@endif
```

#### 設定画面
- BGM/SE音量調整
- テキスト速度調整
- ウィンドウモード切り替え
- キーコンフィグ

### 優先度：中

#### リッチテキスト演出
```
主人公:これは[b]太文字[/b]で、これは[color=red]赤色[/color]です。
```

#### アニメーション
```
@animate chara alice shake duration:1.0
@animate bg fade_out duration:2.0
```

#### TIPS/用語集
```
主人公:これは[tips=用語1]特殊な用語[/tips]です。
```

#### CG解放
- CG管理システム
- ギャラリー画面
- 解放条件設定

### 優先度：低

#### パララクス表示
- 立ち絵・背景・アイテムのレイヤー分け
- 奥行き感の演出

#### ポストエフェクト
- ブラー、セピア、モノクロなどのフィルター
- カメラシェイク

#### ピクチャーインピクチャー
- 画面分割演出
- 回想シーン表示

#### ボイス再生
- キャラクターボイス再生
- リップシンク

---

## 技術メモ

### Godot 4.x 構文の使用
- `@export var` (Godot 3.x の `export var` は使用禁止)
- `await` (Godot 3.x の `yield` は使用禁止)
- `@onready var` (Godot 3.x の `onready var` は使用禁止)
- シグナル接続: `signal_name.connect(method_name)`

### 静的型付け
全ての変数・引数・戻り値に型ヒントを付与:
```gdscript
var health: int = 100
func damage(amount: int) -> void:
    health -= amount
```

### パフォーマンス
- コマンドクラスは軽量（RefCounted継承）
- 辞書検索は O(1)
- テクスチャキャッシュ機能

### デバッグ
- `print()` でコマンド実行ログを出力
- CommandRegistry初期化時にコマンド一覧を表示
- エラーハンドリング: `push_error()`, `push_warning()
